{
  "version": "1.1.0",
  "collections": [
    {
      "name": "Seguridad",
      "requests": [
        {
          "name": "Create User",
          "request": {
            "url": "{{base}}/create_user",
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"name\":\"Prueba\",\"email\":\"prueba@example.com\",\"password\":\"secret123\"}"
            }
          }
        },
        {
          "name": "Gateway Login",
          "request": {
            "url": "{{base}}/auth/login",
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"admin\",\"password\":\"password\"}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Save token returned by the gateway into the environment variable 'token'",
                  "try {",
                  "  const data = JSON.parse(responseBody || '{}');",
                  "  if (data && data.token) {",
                  "    // Postman-style environment set (Thunder Client supports pm.* in scripts)",
                  "    if (typeof pm !== 'undefined' && pm.environment) { pm.environment.set('token', data.token); }",
                  "    // also try common alternatives for compatibility",
                  "    if (typeof client !== 'undefined' && client.setEnvironmentVariable) { client.setEnvironmentVariable('token', data.token); }",
                  "    if (typeof thunder !== 'undefined' && thunder.setEnv) { thunder.setEnv('token', data.token); }",
                  "    console.log('Saved token to environment');",
                  "  }",
                  "} catch (e) { console.error('Error saving token:', e); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Create User (via Gateway)",
          "request": {
            "url": "{{base}}/seguridad/api/create_user",
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"name\":\"Prueba\",\"email\":\"prueba@example.com\",\"password\":\"secret123\"}"
            }
          }
        },
        {
          "name": "List Users (via Gateway)",
          "request": {
            "url": "{{base}}/seguridad/api/users",
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ]
          }
        },
        {
          "name": "Consulta Protected Example",
          "request": {
            "url": "{{base}}/consulta/protected/example",
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ]
          }
        },
        {
          "name": "Change Password",
          "request": {
            "url": "{{base}}/change_password",
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"current_password\":\"secret123\",\"new_password\":\"newsecret123\"}"
            }
          }
        },
        {
          "name": "Logout",
          "request": {
            "url": "{{base}}/logout",
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ]
          }
        },
        {
          "name": "Forgot Password (send link)",
          "request": {
            "url": "{{base}}/forgot_password",
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"email\":\"prueba@example.com\"}"
            }
          }
        },
        {
          "name": "Reset Password (use token)",
          "request": {
            "url": "{{base}}/reset_password",
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"email\":\"prueba@example.com\",\"token\":\"<TOKEN_FROM_EMAIL>\",\"password\":\"finalpass123\",\"password_confirmation\":\"finalpass123\"}"
            }
          }
        },
        {
          "name": "Assign Role (admin only)",
          "request": {
            "url": "{{base}}/users/1/roles/assign",
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"role\":\"admin\"}"
            }
          }
        },
        {
          "name": "List User Roles",
          "request": {
            "url": "{{base}}/users/1/roles",
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}" }
            ]
          }
        }
      ]
    }
  ],
  "environments": [
    {
      "name": "Seguridad",
      "values": [
        { "key": "base", "value": "http://127.0.0.1:3000", "enabled": true },
        { "key": "token", "value": "", "enabled": true }
      ]
    }
  ]
}
